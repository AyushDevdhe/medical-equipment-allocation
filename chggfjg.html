<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Silent Queue System - Process Flow Diagram</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: system-ui, -apple-system, sans-serif;
        }
    </style>
</head>
<body>
    <div class="w-full min-h-screen bg-white flex flex-col">
        <!-- Header -->
        <div class="bg-slate-800 text-white p-6 text-center">
            <h1 class="text-3xl font-bold mb-2">Silent Queue System</h1>
            <p class="text-lg text-slate-300">Process Flow Diagram</p>
        </div>

        <!-- Download Button -->
        <div class="bg-slate-100 border-b border-slate-300 p-4 flex justify-center">
            <button onclick="downloadAsPNG()" class="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition shadow-lg cursor-pointer">
                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                </svg>
                Download as PNG Image
            </button>
        </div>

        <!-- Diagram -->
        <div class="flex-1 p-8 overflow-auto bg-white" id="diagramContainer">
            <svg width="1600" height="2000" viewBox="0 0 1600 2000" class="mx-auto border border-slate-200" id="mainDiagram">
                <defs>
                    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                        <polygon points="0 0, 10 3, 0 6" fill="#334155" />
                    </marker>
                    <marker id="arrowRed" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                        <polygon points="0 0, 10 3, 0 6" fill="#dc2626" />
                    </marker>
                </defs>

                <!-- White background -->
                <rect width="1600" height="2000" fill="white" />

                <!-- Title -->
                <text x="800" y="40" text-anchor="middle" font-size="28" font-weight="bold" fill="#1e293b">
                    Silent Queue System - Process Flow
                </text>

                <!-- Swimlane Headers -->
                <rect x="50" y="70" width="1500" height="50" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="2" />
                <text x="200" y="102" text-anchor="middle" font-size="18" font-weight="bold" fill="#334155">User</text>
                <text x="500" y="102" text-anchor="middle" font-size="18" font-weight="bold" fill="#334155">Frontend (React)</text>
                <text x="900" y="102" text-anchor="middle" font-size="18" font-weight="bold" fill="#334155">Backend (Node.js)</text>
                <text x="1300" y="102" text-anchor="middle" font-size="18" font-weight="bold" fill="#334155">Database (PostgreSQL)</text>

                <!-- Swimlanes -->
                <line x1="350" y1="70" x2="350" y2="1950" stroke="#cbd5e1" stroke-width="2" />
                <line x1="700" y1="70" x2="700" y2="1950" stroke="#cbd5e1" stroke-width="2" />
                <line x1="1100" y1="70" x2="1100" y2="1950" stroke="#cbd5e1" stroke-width="2" />

                <!-- START -->
                <ellipse cx="200" cy="160" rx="70" ry="35" fill="#10b981" stroke="#059669" stroke-width="3" />
                <text x="200" y="168" text-anchor="middle" font-size="16" font-weight="bold" fill="white">START</text>

                <!-- Step 1 -->
                <rect x="130" y="220" width="140" height="60" rx="8" fill="#3b82f6" stroke="#1e40af" stroke-width="2" />
                <text x="200" y="245" text-anchor="middle" font-size="14" fill="white" font-weight="600">Opens Silent</text>
                <text x="200" y="265" text-anchor="middle" font-size="14" fill="white" font-weight="600">Queue App</text>
                <line x1="200" y1="195" x2="200" y2="220" stroke="#334155" stroke-width="2" marker-end="url(#arrow)" />

                <!-- SECTION 1: QUEUE JOIN PROCESS -->
                <rect x="50" y="310" width="1500" height="30" fill="#fee2e2" stroke="#dc2626" stroke-width="2" />
                <text x="800" y="330" text-anchor="middle" font-size="16" font-weight="bold" fill="#991b1b">
                    QUEUE JOIN PROCESS
                </text>

                <!-- User enters details -->
                <rect x="130" y="370" width="140" height="60" rx="8" fill="#3b82f6" stroke="#1e40af" stroke-width="2" />
                <text x="200" y="395" text-anchor="middle" font-size="14" fill="white" font-weight="600">Enter Details</text>
                <text x="200" y="415" text-anchor="middle" font-size="14" fill="white" font-weight="600">in Join Form</text>
                <line x1="200" y1="280" x2="200" y2="370" stroke="#334155" stroke-width="2" marker-end="url(#arrow)" />

                <!-- Arrow to frontend -->
                <line x1="270" y1="400" x2="380" y2="400" stroke="#334155" stroke-width="2" marker-end="url(#arrow)" />
                <text x="325" y="390" text-anchor="middle" font-size="12" fill="#475569">Form Data</text>

                <!-- Frontend validates -->
                <rect x="380" y="370" width="180" height="60" rx="8" fill="#8b5cf6" stroke="#6d28d9" stroke-width="2" />
                <text x="470" y="395" text-anchor="middle" font-size="14" fill="white" font-weight="600">Validate Input</text>
                <text x="470" y="415" text-anchor="middle" font-size="14" fill="white" font-weight="600">POST /api/queue/join</text>

                <!-- Decision: Valid? -->
                <polygon points="470,460 510,490 470,520 430,490" fill="#fef3c7" stroke="#f59e0b" stroke-width="2" />
                <text x="470" y="495" text-anchor="middle" font-size="13" font-weight="bold" fill="#78350f">Valid?</text>
                <line x1="470" y1="430" x2="470" y2="460" stroke="#334155" stroke-width="2" marker-end="url(#arrow)" />

                <!-- Invalid path -->
                <line x1="430" y1="490" x2="350" y2="490" stroke="#dc2626" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowRed)" />
                <line x1="350" y1="490" x2="350" y2="420" stroke="#dc2626" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowRed)" />
                <text x="380" y="480" font-size="12" font-weight="bold" fill="#dc2626">Invalid</text>
                <rect x="320" y="390" width="60" height="30" rx="5" fill="#fee2e2" stroke="#dc2626" stroke-width="1" />
                <text x="350" y="410" text-anchor="middle" font-size="11" fill="#dc2626" font-weight="600">Error</text>

                <!-- Valid to backend -->
                <line x1="510" y1="490" x2="720" y2="490" stroke="#334155" stroke-width="2" marker-end="url(#arrow)" />
                <text x="615" y="480" text-anchor="middle" font-size="12" fill="#475569">Valid</text>

                <!-- Backend processes -->
                <rect x="720" y="460" width="180" height="60" rx="8" fill="#10b981" stroke="#059669" stroke-width="2" />
                <text x="810" y="485" text-anchor="middle" font-size="14" fill="white" font-weight="600">Process Join</text>
                <text x="810" y="505" text-anchor="middle" font-size="14" fill="white" font-weight="600">Request</text>

                <!-- Decision: Queue full? -->
                <polygon points="810,550 850,580 810,610 770,580" fill="#fef3c7" stroke="#f59e0b" stroke-width="2" />
                <text x="810" y="582" text-anchor="middle" font-size="12" font-weight="bold" fill="#78350f">Queue</text>
                <text x="810" y="595" text-anchor="middle" font-size="12" font-weight="bold" fill="#78350f">Full?</text>
                <line x1="810" y1="520" x2="810" y2="550" stroke="#334155" stroke-width="2" marker-end="url(#arrow)" />

                <!-- Queue full path -->
                <line x1="770" y1="580" x2="650" y2="580" stroke="#dc2626" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowRed)" />
                <line x1="650" y1="580" x2="650" y2="510" stroke="#dc2626" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowRed)" />
                <text x="700" y="570" font-size="12" font-weight="bold" fill="#dc2626">Yes</text>
                <rect x="620" y="480" width="60" height="30" rx="5" fill="#fee2e2" stroke="#dc2626" stroke-width="1" />
                <text x="650" y="500" text-anchor="middle" font-size="11" fill="#dc2626" font-weight="600">Full</text>

                <!-- To database -->
                <line x1="850" y1="580" x2="1120" y2="580" stroke="#334155" stroke-width="2" marker-end="url(#arrow)" />
                <text x="985" y="570" text-anchor="middle" font-size="12" fill="#475569">No - Create</text>

                <!-- Database creates record -->
                <rect x="1120" y="550" width="180" height="60" rx="8" fill="#f59e0b" stroke="#d97706" stroke-width="2" />
                <text x="1210" y="575" text-anchor="middle" font-size="14" fill="white" font-weight="600">Create User Record</text>
                <text x="1210" y="595" text-anchor="middle" font-size="14" fill="white" font-weight="600">Assign Position</text>

                <!-- DB confirms -->
                <line x1="1120" y1="630" x2="900" y2="660" stroke="#334155" stroke-width="2" marker-end="url(#arrow)" />
                <text x="1010" y="640" text-anchor="middle" font-size="12" fill="#475569">Confirm</text>

                <!-- Backend calculates -->
                <rect x="720" y="640" width="180" height="60" rx="8" fill="#10b981" stroke="#059669" stroke-width="2" />
                <text x="810" y="665" text-anchor="middle" font-size="14" fill="white" font-weight="600">Calculate Wait</text>
                <text x="810" y="685" text-anchor="middle" font-size="14" fill="white" font-weight="600">Time & Position</text>

                <!-- To frontend -->
                <line x1="720" y1="670" x2="560" y2="670" stroke="#334155" stroke-width="2" marker-end="url(#arrow)" />
                <text x="640" y="660" text-anchor="middle" font-size="12" fill="#475569">Response</text>

                <!-- Frontend displays -->
                <rect x="380" y="640" width="180" height="60" rx="8" fill="#8b5cf6" stroke="#6d28d9" stroke-width="2" />
                <text x="470" y="665" text-anchor="middle" font-size="14" fill="white" font-weight="600">Display Position</text>
                <text x="470" y="685" text-anchor="middle" font-size="14" fill="white" font-weight="600">& Wait Time</text>

                <!-- User sees -->
                <line x1="380" y1="670" x2="270" y2="670" stroke="#334155" stroke-width="2" marker-end="url(#arrow)" />

                <rect x="130" y="640" width="140" height="60" rx="8" fill="#3b82f6" stroke="#1e40af" stroke-width="2" />
                <text x="200" y="665" text-anchor="middle" font-size="14" fill="white" font-weight="600">View Queue</text>
                <text x="200" y="685" text-anchor="middle" font-size="14" fill="white" font-weight="600">Position</text>

                <!-- SECTION 2: REAL-TIME MONITORING -->
                <rect x="50" y="730" width="1500" height="30" fill="#dbeafe" stroke="#2563eb" stroke-width="2" />
                <text x="800" y="750" text-anchor="middle" font-size="16" font-weight="bold" fill="#1e40af">
                    REAL-TIME MONITORING LOOP (Every 30s)
                </text>

                <!-- Frontend polls -->
                <rect x="380" y="790" width="180" height="60" rx="8" fill="#8b5cf6" stroke="#6d28d9" stroke-width="2" />
                <text x="470" y="815" text-anchor="middle" font-size="14" fill="white" font-weight="600">Poll Status</text>
                <text x="470" y="835" text-anchor="middle" font-size="13" fill="white">GET /api/queue/status</text>

                <line x1="470" y1="700" x2="470" y2="790" stroke="#334155" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrow)" />

                <!-- To backend -->
                <line x1="560" y1="820" x2="720" y2="820" stroke="#334155" stroke-width="2" marker-end="url(#arrow)" />

                <!-- Backend fetches -->
                <rect x="720" y="790" width="180" height="60" rx="8" fill="#10b981" stroke="#059669" stroke-width="2" />
                <text x="810" y="820" text-anchor="middle" font-size="14" fill="white" font-weight="600">Fetch Queue Data</text>

                <!-- To database -->
                <line x1="900" y1="820" x2="1120" y2="820" stroke="#334155" stroke-width="2" marker-end="url(#arrow)" />

                <!-- Database queries -->
                <rect x="1120" y="790" width="180" height="60" rx="8" fill="#f59e0b" stroke="#d97706" stroke-width="2" />
                <text x="1210" y="815" text-anchor="middle" font-size="14" fill="white" font-weight="600">Query Current</text>
                <text x="1210" y="835" text-anchor="middle" font-size="14" fill="white" font-weight="600">Queue State</text>

                <!-- DB returns -->
                <line x1="1120" y1="870" x2="900" y2="900" stroke="#334155" stroke-width="2" marker-end="url(#arrow)" />

                <!-- Backend sends -->
                <rect x="720" y="880" width="180" height="60" rx="8" fill="#10b981" stroke="#059669" stroke-width="2" />
                <text x="810" y="905" text-anchor="middle" font-size="14" fill="white" font-weight="600">Send Status</text>
                <text x="810" y="925" text-anchor="middle" font-size="14" fill="white" font-weight="600">Update</text>

                <!-- To frontend -->
                <line x1="720" y1="910" x2="560" y2="910" stroke="#334155" stroke-width="2" marker-end="url(#arrow)" />

                <!-- Frontend updates -->
                <rect x="380" y="880" width="180" height="60" rx="8" fill="#8b5cf6" stroke="#6d28d9" stroke-width="2" />
                <text x="470" y="905" text-anchor="middle" font-size="14" fill="white" font-weight="600">Update Live</text>
                <text x="470" y="925" text-anchor="middle" font-size="14" fill="white" font-weight="600">Display</text>

                <!-- User sees -->
                <line x1="380" y1="910" x2="270" y2="910" stroke="#334155" stroke-width="2" marker-end="url(#arrow)" />

                <rect x="130" y="880" width="140" height="60" rx="8" fill="#3b82f6" stroke="#1e40af" stroke-width="2" />
                <text x="200" y="905" text-anchor="middle" font-size="14" fill="white" font-weight="600">See Live</text>
                <text x="200" y="925" text-anchor="middle" font-size="14" fill="white" font-weight="600">Updates</text>

                <!-- Loop arrow -->
                <path d="M 400 790 L 400 760 L 540 760 L 540 940 L 430 940" stroke="#8b5cf6" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrow)" fill="none" />
                <text x="520" y="850" font-size="13" font-weight="bold" fill="#6d28d9">Loop</text>

                <!-- SECTION 3: ADMIN MANAGEMENT -->
                <rect x="50" y="980" width="1500" height="30" fill="#fef3c7" stroke="#f59e0b" stroke-width="2" />
                <text x="800" y="1000" text-anchor="middle" font-size="16" font-weight="bold" fill="#92400e">
                    ADMIN MANAGEMENT PROCESS
                </text>

                <!-- Admin logs in -->
                <rect x="130" y="1040" width="140" height="60" rx="8" fill="#6366f1" stroke="#4338ca" stroke-width="2" />
                <text x="200" y="1065" text-anchor="middle" font-size="14" fill="white" font-weight="600">Admin Logs In</text>
                <text x="200" y="1085" text-anchor="middle" font-size="14" fill="white" font-weight="600">to Dashboard</text>

                <!-- To frontend -->
                <line x1="270" y1="1070" x2="380" y2="1070" stroke="#334155" stroke-width="2" marker-end="url(#arrow)" />

                <!-- Frontend auth -->
                <rect x="380" y="1040" width="180" height="60" rx="8" fill="#8b5cf6" stroke="#6d28d9" stroke-width="2" />
                <text x="470" y="1065" text-anchor="middle" font-size="14" fill="white" font-weight="600">Authenticate</text>
                <text x="470" y="1085" text-anchor="middle" font-size="13" fill="white">GET /api/admin/queues</text>

                <!-- Decision: Authorized? -->
                <polygon points="470,1130 510,1160 470,1190 430,1160" fill="#fef3c7" stroke="#f59e0b" stroke-width="2" />
                <text x="470" y="1165" text-anchor="middle" font-size="12" font-weight="bold" fill="#78350f">Auth?</text>
                <line x1="470" y1="1100" x2="470" y2="1130" stroke="#334155" stroke-width="2" marker-end="url(#arrow)" />

                <!-- Not authorized -->
                <line x1="430" y1="1160" x2="350" y2="1160" stroke="#dc2626" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowRed)" />
                <line x1="350" y1="1160" x2="350" y2="1090" stroke="#dc2626" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowRed)" />
                <text x="380" y="1150" font-size="12" font-weight="bold" fill="#dc2626">No</text>
                <rect x="320" y="1060" width="60" height="30" rx="5" fill="#fee2e2" stroke="#dc2626" stroke-width="1" />
                <text x="350" y="1080" text-anchor="middle" font-size="11" fill="#dc2626" font-weight="600">Denied</text>

                <!-- Authorized -->
                <line x1="510" y1="1160" x2="720" y2="1160" stroke="#334155" stroke-width="2" marker-end="url(#arrow)" />
                <text x="615" y="1150" text-anchor="middle" font-size="12" fill="#475569">Yes</text>

                <!-- Backend retrieves -->
                <rect x="720" y="1130" width="180" height="60" rx="8" fill="#10b981" stroke="#059669" stroke-width="2" />
                <text x="810" y="1155" text-anchor="middle" font-size="14" fill="white" font-weight="600">Retrieve All</text>
                <text x="810" y="1175" text-anchor="middle" font-size="14" fill="white" font-weight="600">Queue Data</text>

                <!-- To database -->
                <line x1="900" y1="1160" x2="1120" y2="1160" stroke="#334155" stroke-width="2" marker-end="url(#arrow)" />

                <!-- Database queries -->
                <rect x="1120" y="1130" width="180" height="60" rx="8" fill="#f59e0b" stroke="#d97706" stroke-width="2" />
                <text x="1210" y="1155" text-anchor="middle" font-size="14" fill="white" font-weight="600">Query All</text>
                <text x="1210" y="1175" text-anchor="middle" font-size="14" fill="white" font-weight="600">Queue Records</text>

                <!-- Returns -->
                <line x1="1120" y1="1210" x2="900" y2="1240" stroke="#334155" stroke-width="2" marker-end="url(#arrow)" />

                <!-- Backend formats -->
                <rect x="720" y="1220" width="180" height="60" rx="8" fill="#10b981" stroke="#059669" stroke-width="2" />
                <text x="810" y="1245" text-anchor="middle" font-size="14" fill="white" font-weight="600">Format Dashboard</text>
                <text x="810" y="1265" text-anchor="middle" font-size="14" fill="white" font-weight="600">Data</text>

                <!-- To frontend -->
                <line x1="720" y1="1250" x2="560" y2="1250" stroke="#334155" stroke-width="2" marker-end="url(#arrow)" />

                <!-- Frontend displays -->
                <rect x="380" y="1220" width="180" height="60" rx="8" fill="#8b5cf6" stroke="#6d28d9" stroke-width="2" />
                <text x="470" y="1245" text-anchor="middle" font-size="14" fill="white" font-weight="600">Display Admin</text>
                <text x="470" y="1265" text-anchor="middle" font-size="14" fill="white" font-weight="600">Dashboard</text>

                <!-- Admin sees -->
                <line x1="380" y1="1250" x2="270" y2="1250" stroke="#334155" stroke-width="2" marker-end="url(#arrow)" />

                <rect x="130" y="1220" width="140" height="60" rx="8" fill="#6366f1" stroke="#4338ca" stroke-width="2" />
                <text x="200" y="1245" text-anchor="middle" font-size="14" fill="white" font-weight="600">View Queue</text>
                <text x="200" y="1265" text-anchor="middle" font-size="14" fill="white" font-weight="600">Dashboard</text>

                <!-- Admin marks complete -->
                <rect x="130" y="1310" width="140" height="60" rx="8" fill="#6366f1" stroke="#4338ca" stroke-width="2" />
                <text x="200" y="1335" text-anchor="middle" font-size="14" fill="white" font-weight="600">Mark Service</text>
                <text x="200" y="1355" text-anchor="middle" font-size="14" fill="white" font-weight="600">Complete</text>
                <line x1="200" y1="1280" x2="200" y2="1310" stroke="#334155" stroke-width="2" marker-end="url(#arrow)" />

                <!-- To frontend -->
                <line x1="270" y1="1340" x2="380" y2="1340" stroke="#334155" stroke-width="2" marker-end="url(#arrow)" />

                <!-- Frontend sends -->
                <rect x="380" y="1310" width="180" height="60" rx="8" fill="#8b5cf6" stroke="#6d28d9" stroke-width="2" />
                <text x="470" y="1335" text-anchor="middle" font-size="14" fill="white" font-weight="600">Send Update</text>
                <text x="470" y="1355" text-anchor="middle" font-size="13" fill="white">POST /api/queue/next</text>

                <!-- To backend -->
                <line x1="560" y1="1340" x2="720" y2="1340" stroke="#334155" stroke-width="2" marker-end="url(#arrow)" />

                <!-- Backend processes -->
                <rect x="720" y="1310" width="180" height="60" rx="8" fill="#10b981" stroke="#059669" stroke-width="2" />
                <text x="810" y="1335" text-anchor="middle" font-size="14" fill="white" font-weight="600">Process Next</text>
                <text x="810" y="1355" text-anchor="middle" font-size="14" fill="white" font-weight="600">in Queue</text>

                <!-- To database -->
                <line x1="900" y1="1340" x2="1120" y2="1340" stroke="#334155" stroke-width="2" marker-end="url(#arrow)" />

                <!-- Database updates -->
                <rect x="1120" y="1310" width="180" height="60" rx="8" fill="#f59e0b" stroke="#d97706" stroke-width="2" />
                <text x="1210" y="1335" text-anchor="middle" font-size="14" fill="white" font-weight="600">Update Position</text>
                <text x="1210" y="1355" text-anchor="middle" font-size="14" fill="white" font-weight="600">Mark as Served</text>

                <!-- Confirms -->
                <line x1="1120" y1="1390" x2="900" y2="1420" stroke="#334155" stroke-width="2" marker-end="url(#arrow)" />

                <!-- Backend broadcasts -->
                <rect x="720" y="1400" width="180" height="60" rx="8" fill="#10b981" stroke="#059669" stroke-width="2" />
                <text x="810" y="1425" text-anchor="middle" font-size="14" fill="white" font-weight="600">Broadcast Update</text>
                <text x="810" y="1445" text-anchor="middle" font-size="14" fill="white" font-weight="600">to All Clients</text>

                <!-- Broadcast arrows -->
                <line x1="720" y1="1430" x2="560" y2="1430" stroke="#334155" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrow)" />
                <line x1="720" y1="1430" x2="560" y2="1520" stroke="#334155" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrow)" />
                <text x="640" y="1420" text-anchor="middle" font-size="12" fill="#475569" font-weight="600">Broadcast</text>

                <!-- Frontend updates all -->
                <rect x="380" y="1400" width="180" height="60" rx="8" fill="#8b5cf6" stroke="#6d28d9" stroke-width="2" />
                <text x="470" y="1425" text-anchor="middle" font-size="14" fill="white" font-weight="600">Update All</text>
                <text x="470" y="1445" text-anchor="middle" font-size="14" fill="white" font-weight="600">Connected Users</text>

                <!-- SECTION 4: USER NOTIFICATION -->
                <rect x="50" y="1490" width="1500" height="30" fill="#dcfce7" stroke="#10b981" stroke-width="2" />
                <text x="800" y="1510" text-anchor="middle" font-size="16" font-weight="bold" fill="#047857">
                    USER NOTIFICATION & SERVICE
                </text>

                <!-- Frontend notifies -->
                <rect x="380" y="1550" width="180" height="60" rx="8" fill="#8b5cf6" stroke="#6d28d9" stroke-width="2" />
                <text x="470" y="1575" text-anchor="middle" font-size="14" fill="white" font-weight="600">"Your Turn Now"</text>
                <text x="470" y="1595" text-anchor="middle" font-size="14" fill="white" font-weight="600">Notification</text>

                <!-- User notified -->
                <line x1="380" y1="1580" x2="270" y2="1580" stroke="#334155" stroke-width="2" marker-end="url(#arrow)" />

                <rect x="130" y="1550" width="140" height="60" rx="8" fill="#3b82f6" stroke="#1e40af" stroke-width="2" />
                <text x="200" y="1575" text-anchor="middle" font-size="14" fill="white" font-weight="600">"Your Turn"</text>
                <text x="200" y="1595" text-anchor="middle" font-size="14" fill="white" font-weight="600">Received</text>

                <!-- User receives service -->
                <rect x="130" y="1640" width="140" height="60" rx="8" fill="#3b82f6" stroke="#1e40af" stroke-width="2" />
                <text x="200" y="1665" text-anchor="middle" font-size="14" fill="white" font-weight="600">Receives</text>
                <text x="200" y="1685" text-anchor="middle" font-size="14" fill="white" font-weight="600">Service</text>
                <line x1="200" y1="1610" x2="200" y2="1640" stroke="#334155" stroke-width="2" marker-end="url(#arrow)" />

                <!-- END -->
                <ellipse cx="200" cy="1760" rx="70" ry="35" fill="#dc2626" stroke="#991b1b" stroke-width="3" />
                <text x="200" y="1768" text-anchor="middle" font-size="16" font-weight="bold" fill="white">END</text>
                <line x1="200" y1="1700" x2="200" y2="1725" stroke="#334155" stroke-width="2" marker-end="url(#arrow)" />

                <!-- Legend -->
                <g transform="translate(100, 1830)">
                    <text x="0" y="0" font-size="18" font-weight="bold" fill="#1e293b">Legend:</text>
                    
                    <rect x="0" y="15" width="100" height="40" rx="6" fill="#3b82f6" stroke="#1e40af" stroke-width="2" />
                    <text x="110" y="40" font-size="14" fill="#1e293b" font-weight="600">User Action</text>

                    <rect x="250" y="15" width="100" height="40" rx="6" fill="#8b5cf6" stroke="#6d28d9" stroke-width="2" />
                    <text x="360" y="40" font-size="14" fill="#1e293b" font-weight="600">Frontend</text>

                    <rect x="480" y="15" width="100" height="40" rx="6" fill="#10b981" stroke="#059669" stroke-width="2" />
                    <text x="590" y="40" font-size="14" fill="#1e293b" font-weight="600">Backend</text>

                    <rect x="710" y="15" width="100" height="40" rx="6" fill="#f59e0b" stroke="#d97706" stroke-width="2" />
                    <text x="820" y="40" font-size="14" fill="#1e293b" font-weight="600">Database</text>

                    <rect x="960" y="15" width="100" height="40" rx="6" fill="#6366f1" stroke="#4338ca" stroke-width="2" />
                    <text x="1070" y="40" font-size="14" fill="#1e293b" font-weight="600">Admin</text>

                    <polygon points="0,85 35,105 0,125 -35,105" fill="#fef3c7" stroke="#f59e0b" stroke-width="2" />
                    <text x="45" y="110" font-size="14" fill="#1e293b" font-weight="600">Decision</text>

                    <line x1="250" y1="95" x2="330" y2="95" stroke="#334155" stroke-width="2" marker-end="url(#arrow)" />
                    <text x="340" y="100" font-size="14" fill="#1e293b" font-weight="600">Data Flow</text>

                    <line x1="480" y1="95" x2="560" y2="95" stroke="#334155" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrow)" />
                    <text x="570" y="100" font-size="14" fill="#1e293b" font-weight="600">Async/Loop</text>

                    <line x1="710" y1="95" x2="790" y2="95" stroke="#dc2626" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowRed)" />
                    <text x="800" y="100" font-size="14" fill="#1e293b" font-weight="600">Error Path</text>
                </g>
            </svg>
        </div>

        <!-- Instructions -->
        <div class="bg-slate-100 border-t border-slate-300 p-4 text-center">
            <p class="text-sm text-slate-700 font-semibold mb-1">
                ðŸ“¥ Click "Download as PNG Image" button above to save this diagram for your report
            </p>
            <p class="text-xs text-slate-600">
                The image will be 1600x2000 pixels - perfect for documents and presentations
            </p>
        </div>
    </div>

    <script>
        function downloadAsPNG() {
            const svgElement = document.getElementById('mainDiagram');
            const svgData = new XMLSerializer().serializeToString(svgElement);
            
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            
            canvas.width = 1600;
            canvas.height = 2000;
            
            const svgBlob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });
            const url = URL.createObjectURL(svgBlob);
            
            img.onload = function() {
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(img, 0, 0);
                URL.revokeObjectURL(url);
                
                canvas.toBlob(function(blob) {
                    const link = document.createElement('a');
                    link.download = 'silent-queue-process-flow.png';
                    link.href = URL.createObjectURL(blob);
                    link.click();
                }, 'image/png');
            };
            
            img.onerror = function() {
                alert('Error converting diagram to image. Please try taking a screenshot instead.');
            };
            
            img.src = url;
        }
    </script>
</body>
</html>